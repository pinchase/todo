{% extends 'tasks/base.html' %}

{% block title %}My Tasks - To-Do App{% endblock %}

{% block content %}
<div class="container">
    <!-- Email Verification Banner -->
    {% if not is_email_verified %}
    <div class="verification-banner">
        <div class="verification-content">
            <span class="verification-icon">‚ö†Ô∏è</span>
            <div class="verification-text">
                <strong>Email not verified!</strong>
                <p>Please check your inbox and verify your email to unlock all features.</p>
            </div>
            <a href="{% url 'resend_verification' %}" class="btn-resend">
                üìß Resend Email
            </a>
        </div>
    </div>
    {% endif %}

    <div class="dashboard-header">
        <h1>My Tasks</h1>
        <a href="{% url 'add_task' %}" class="btn btn-primary">+ Add New Task</a>
    </div>

    <div class="tasks-stats">
        <div class="stat-card">
            <h3>{{ tasks.count }}</h3>
            <p>Total Tasks</p>
        </div>
        <div class="stat-card">
            <h3 id="pending-count">0</h3>
            <p>Pending</p>
        </div>
        <div class="stat-card completed">
            <h3 id="completed-count">0</h3>
            <p>Completed</p>
        </div>
    </div>

    <div class="tasks-container">
        {% if tasks %}
            <div class="tasks-list" id="tasksList">
                {% for task in tasks %}
                <div class="task-card {% if task.completed %}completed{% endif %}" data-task-id="{{ task.id }}">
                    <div class="task-content">
                        <div class="task-checkbox">
                            <input type="checkbox"
                                   id="task-{{ task.id }}"
                                   {% if task.completed %}checked{% endif %}
                                   onchange="toggleTask({{ task.id }})">
                        </div>
                        <div class="task-details">
                            <h3 class="task-title">{{ task.title }}</h3>
                            {% if task.description %}
                                <p class="task-description">{{ task.description }}</p>
                            {% endif %}
                            <span class="task-date">Created: {{ task.created_at|date:"M d, Y" }}</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <a href="{% url 'edit_task' task.id %}" class="btn-icon" title="Edit">
                            ‚úèÔ∏è
                        </a>
                        <button onclick="deleteTask({{ task.id }})" class="btn-icon" title="Delete">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <h2>üì≠ No tasks yet!</h2>
                <p>Start by adding your first task.</p>
                <a href="{% url 'add_task' %}" class="btn btn-primary">Add Task</a>
            </div>
        {% endif %}
    </div>
</div>

<script>
    // Update counters
    document.addEventListener('DOMContentLoaded', function() {
        const totalTasks = {{ tasks.count }};
        const completedTasks = document.querySelectorAll('input[type="checkbox"]:checked').length;
        const pendingTasks = totalTasks - completedTasks;

        document.getElementById('completed-count').textContent = completedTasks;
        document.getElementById('pending-count').textContent = pendingTasks;
    });
</script>
{% endblock %}